<docs lang="markdown">
    [TODO: write documentation for this plugin.]
</docs>

<config lang="json">
    {
    "name": "PythonServer",
    "type": "native-python",
    "version": "0.1.0",
    "api_version": "0.1.2",
    "description": "[TODO: describe this plugin with one sentence.]",
    "tags": [],
    "ui": "",
    "inputs": null,
    "outputs": null,
    "flags": [],
    "icon": "extension",
    "env": "",
    "requirements": [],
    "dependencies": [
    "gywgithub/ImJoy-Demo-Plugins:ResultWindow",
    "gywgithub/ImJoy-Demo-Plugins:Function I",
    "gywgithub/ImJoy-Demo-Plugins:Function II",
    "gywgithub/ImJoy-Demo-Plugins:Function III",
    "gywgithub/ImJoy-Demo-Plugins:Function IV",
    "gywgithub/ImJoy-Demo-Plugins:Function V",
    "gywgithub/ImJoy-Demo-Plugins:Function VI"
    ]
    }
</config>

<script lang="python">
    import numpy as np
    import random
    import time
    class ImJoyPlugin():

        def setup(self):
        print('setup in python')

    async def run(self, my):
        print('hello world.')


    # 人脸检测
    async def predict(self, list):
        res = []
    for item in list:
        print(item)
    res.append({
        'IOU': random.random(),
        'fileName': item.filename,
        'url1': item.url,
        'message': ''
    })

    print(res)
    time.sleep(1)
    return res

    # 1: 1 人脸核验
    async def predictII(self, args):
        print(args)
    url1 = 'http://192.168.199.172:3000/images/t.jpg'
    url2 = 'http://192.168.199.172:3000/images/t2.jpg'

    win = await api.createWindow({
        'name': 'ResultWindow',
        'type': 'ResultWindow',
        'w': 40,
        'h': 15,
        'data': {
            'ID': 0,
            'flag': '是',
            'time': '0s',
            'url1': '',
            'url2': ''
        }
    })
    i = 1
    while i <= 10:
        win.run({
            'function': 'FunctionII',
            'data': {
                'ID': i,
                'flag': '是',
                'time': '0.01s',
                'url1': url1,
                'url2': url2
            }
        })
    i += 1
    return '1'


    # 1: n人脸识别 导入底库
    async def importBaseid(self, args):
        print('importBaseid: ', args)
    time.sleep(2)
    win = await api.createWindow({
        'name': 'ResultWindow',
        'type': 'ResultWindow',
        'w': 40,
        'h': 15,
        'data': {
            'index': 0,
            'fileName': ''
        }
    })
    i = 1
    while i <= 20:
        win.run({
            'function': 'importBaseid',
            'data': {
                'index': 0,
                'fileName': 'cat.jpg'
            }
        })
    i += 1
    return 'ok'

    # 1: n人脸识别 预测
    async def predictIII(self, args):
        print(args)
    url1 = 'http://192.168.199.172:3000/images/t.jpg'
    win = await api.createWindow({
        'name': 'ResultWindow',
        'type': 'ResultWindow',
        'w': 40,
        'h': 15,
        'data': {
            'fileName': '',
            'flag': '是',
            'time': '0s',
            'message': '',
            'url1': ''
        }
    })
    i = 1
    while i <= 10:
        win.run({
            'function': 'FunctionIII',
            'data': {
                'fileName': 'cat.jpg',
                'flag': '是',
                'time': '0.01s',
                'message': '没有人脸',
                'url1': url1
            }
        })
    i += 1
    return '1'



    # 关键点检测
    async def predictIV(self, args):
        print(args)
    url1 = 'http://192.168.199.172:3000/images/t.jpg'
    win = await api.createWindow({
        'name': 'ResultWindow',
        'type': 'ResultWindow',
        'w': 40,
        'h': 15,
        'data': {
            'fileName': '',
            'keyPoint': '',
            'url1': ''
        }
    })
    i = 1
    while i <= 10:
        win.run({
            'function': 'FunctionIV',
            'data': {
                'fileName': 'cat.jpg',
                'keyPoint': '[{x: 1, y: 1}, {x2: 2, y2: 2}]',
                'url1': url1
            }
        })
    i += 1
    return '1'

    # 活体检测
    async def predictV(self, args):
        print(args)
    url1 = 'http://192.168.199.172:3000/images/t.jpg'
    win = await api.createWindow({
        'name': 'ResultWindow',
        'type': 'ResultWindow',
        'w': 40,
        'h': 15,
        'data': {
            'fileName': '',
            'flag': '',
            'url1': url1
        }
    })
    i = 1
    while i <= 10:
        win.run({
            'function': 'FunctionV',
            'data': {
                'fileName': 'cat.jpg',
                'flag': '否',
                'url1': url1
            }
        })
    i += 1
    return '1'

    # 图像质量检测
    async def predictVI(self, args):
        print(args)
    url1 = 'http://192.168.199.172:3000/images/t.jpg'
    win = await api.createWindow({
        'name': 'ResultWindow',
        'type': 'ResultWindow',
        'w': 40,
        'h': 15,
        'data': {
            'fileName': '',
            'message': '',
            'url1': ''
        }
    })
    i = 1
    while i <= 25:
        win.run({
            'function': 'FunctionVI',
            'data': {
                'fileName': 'cat.jpg',
                'message': '图像模糊,详细描述...',
                'url1': url1
            }
        })
    i += 1
    return '1'

    api.export(ImJoyPlugin())
</script>
